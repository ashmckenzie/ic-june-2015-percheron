<!DOCTYPE html>
<html>
  <head>
    <title>Modelling applications with Percheron</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      li { padding-bottom: 20px; }
      p { line-height: 32px; }
      table { border-spacing: 0; border: 1px solid #eee; }
      thead th { background-color: #ddd; }
      thead th, tbody td { padding: 6px; border: 1px solid #eee; }
      pre { background-color: #f0f0f0; }
      pre code { display: block; padding: 0.5em; }

      .concepts_units_attributes table { font-size: 95%; }
      .full_config code { font-size: 68%; }
      .percheron_list_output code { font-size: 82%; }

      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>

    <textarea id="source">

class: center, middle

# Modelling applications with Percheron

<div class="center">
  <img src="./assets/percheron.png" width="40%" />
</div>

### InfraCoders June 9th 2015
[@ashmckenzie](https://twitter.com/ashmckenzie)

---

background-image: url(assets/percheron-bg.png)
layout: true

---

# Percheron

* Open source command line tool to organise your Docker images & containers
* Similar to [Fig](http://www.fig.sh) / [Docker Compose](http://docs.docker.com/compose) but with a more application focus and more features
* [github.com/ashmckenzie/percheron](https://github.com/ashmckenzie/percheron) started Feb 2015
* Strong and intelligent horse :)

---

# Why?

Existing tools lacked:

  * Concept of multiple collections of containers (Stacks)
  * Facility to build 'base' images
  * Dependency management for building / starting

Notable features:

* Version control
* Support for PRE build and POST start scripts
* Ability to generate dependency diagrams

---

# Config

The `.percheron.yml` has two main sections; `docker` and `stacks`:

```ruby
docker:
  host: "https://boot2docker:2376"
  ssl_verify_peer: false

stacks:
  - name: "common"
    description: "Common units for all stacks"
    units: [...]
  - ...
  - name: "app"
    description: "The Application"
    units: [...]
```
---

# Concepts: Stack

Attributes:

| Name          | Req'd | Description                |
| ------------- | :---: | -------------------------- |
| `name`        | Y     |                            |
| `description` | N     | Human oriented description |
| `units`       | Y     | One or more Units          |

The `.percheron.yml` file must have at least one Stack defined

Example:

```ruby
stacks:
  - name: "routing"
    description: "Load balancing and proxying"
    units:
      - name: "load-balancer"
        ...
      - name: "app"
```

???

* I like to group Units together in a Stack which allows independent building and starting/stopping of other Stacks.

---

class: concepts_units_attributes

# Concepts: Unit

Attributes:

| Name                   | Req'd | Description                                        |
| ---------------------- | :---: | -------------------------------------------------- |
| `name`                 | Y     |                                                    |
| `version`              | Y     | Semantic version                                   |
| `dockerfile`           | N     | Path to Dockerfile                                 |
| `docker_image`         | N     | Docker image instead of `dockerfile`               |
| `start_args`           | N     | Array of arguments to pass to the `docker_image`   |
| `instances`            | N     | Number of instances to build / start               |
| `ports`                | N     | Array of external:internal port mappings           |
| `dependant_unit_names` | N     | Array of dependant Unit names to build / start     |
| `startable`            | N     | Is this Unit startable (or is it just an image)?   |
| `pre_build_scripts`    | N     | Array of scripts to execute PRE building the Unit  |
| `post_start_scripts`   | N     | Array of scripts to execute POST starting the Unit |

---

# Concepts: Unit

Example:

```ruby
- name: "load-balancer"
  version: 1.0.0
  dockerfile: "load-balancer/Dockerfile"
  ports:
    - 8888:80
  dependant_unit_names:
    - "common:base"
    - "proxy1"
    - "proxy2"
```

---

# Full .percheron.yml config

---

class: full_config

```ruby
docker:
  host: "https://boot2docker:2376"
  ssl_verify_peer: false

stacks:
  - name: "common"
    description: "Common units for all stacks"
    units:
      - name: "base"
        version: 1.0.0
        dockerfile: "common/Dockerfile"
        startable: false

  - name: "routing"
    description: "Load balancing and proxying"
    units:
      - name: "load-balancer"
        version: 1.0.0
        dockerfile: "load-balancer/Dockerfile"
        ports:
          - 8888:80
        dependant_unit_names:
          - "common:base"
          - "proxy1"
          - "proxy2"

      - name: "proxy"
        instances: 2
        version: 1.0.0
        dockerfile: "proxy/Dockerfile"
        dependant_unit_names:
          - "common:base"
          - "app:app1"
          - "app:app2"

  - name: "app"
    description: "The Application"
    units:
      - name: "app"
        instances: 2
        version: 1.0.0
        dockerfile: "app/Dockerfile"
        dependant_unit_names:
          - "common:base"
```

---

background-image: default
class: percheron_list_output

# percheron list output

```shell
$ bundle exec percheron list

+------+----+----------+-----+-------+---------+---------+
|                         common                         |
+------+----+----------+-----+-------+---------+---------+
| Unit | ID | Running? | IP  | Ports | Volumes | Version |
+------+----+----------+-----+-------+---------+---------+
| base |    | n/a      | n/a |       |         |         |
+------+----+----------+-----+-------+---------+---------+

+---------------+----+----------+-----+---------+---------+---------+
|                              routing                              |
+---------------+----+----------+-----+---------+---------+---------+
| Unit          | ID | Running? | IP  | Ports   | Volumes | Version |
+---------------+----+----------+-----+---------+---------+---------+
| load-balancer |    | -        | n/a | 8888:80 |         |         |
| proxy1        |    | -        | n/a |         |         |         |
| proxy2        |    | -        | n/a |         |         |         |
+---------------+----+----------+-----+---------+---------+---------+

+------+----+----------+-----+-------+---------+---------+
|                          app                           |
+------+----+----------+-----+-------+---------+---------+
| Unit | ID | Running? | IP  | Ports | Volumes | Version |
+------+----+----------+-----+-------+---------+---------+
| app1 |    | -        | n/a |       |         |         |
| app2 |    | -        | n/a |       |         |         |
+------+----+----------+-----+-------+---------+---------+
```

---

# Diagram

---

background-image: default

<div class="center">
  <img src="./assets/percheron_stack.png" width="55%" />
</div>

---

class: center, middle

# Demo

## v0.8.x-dev

---

# Thanks!

Give Percheron a go! [github.com/ashmckenzie/percheron](https://github.com/ashmckenzie/percheron)

Credit to Dan Bradford ([@unroundme](https://twitter.com/unroundme)) for the awesome logo :)

    </textarea>

    <script src="./assets/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
